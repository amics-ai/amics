---
import Layout from '../../layouts/Layout.astro';
import { createZenblogClient } from "zenblog";

// Initialize Zenblog client
const zenblog = createZenblogClient({ blogId: import.meta.env.ZENBLOG_BLOG_ID });

// Get the current slug from params
const { slug } = Astro.params;

// Fetch the specific post
const post = await zenblog.posts.get({slug});

if (!post) {
  return Astro.redirect('/404');
}

export const prerender = true;
export async function getStaticPaths() {
    const zenblog = createZenblogClient({ blogId: import.meta.env.ZENBLOG_BLOG_ID });
  const articles = await zenblog.posts.list();

  return articles.data.map((article) => ({
    params: { slug: article.slug },
    props: article,
  }));
}
---

<Layout title={`${post.data.title} | Amics`}>
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16 pt-24">
    {post.data.cover_image && (
      <div class="mb-8">
        <img
          src={post.data.cover_image}
          alt={post.data.title}
          class="w-full h-[400px] object-cover rounded-lg shadow-lg"
        />
      </div>
    )}

    <header class="mb-8">
      {post.data.tags && (
        <div class="flex flex-wrap gap-2 mb-4">
          {post.data.tags.map((tag) => (
            <span class="text-sm font-medium text-sky-600 bg-sky-50 px-3 py-1 rounded-full">
              {tag.slug}
            </span>
          ))}
        </div>
      )}

      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        {post.data.title}
      </h1>

      <div class="flex items-center text-gray-500 text-sm">
        <time datetime={post.data.published_at}>
          {new Date(post.data.published_at).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
        </time>
      </div>
    </header>

    <div class="prose prose-lg prose-slate prose-headings:font-bold prose-a:text-sky-600 hover:prose-a:text-sky-700 prose-img:rounded-lg prose-pre:bg-gray-800 prose-pre:text-gray-100 max-w-none">
      <Fragment set:html={post.data.html_content} />
    </div>

    <div class="mt-16 border-t border-gray-200 pt-8">
      <a 
        href="/blog" 
        class="text-sky-600 hover:text-sky-800 font-medium flex items-center"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        Back to Blog
      </a>
    </div>
  </article>
</Layout> 